<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Kings and Peasants</title>
  <meta name="description" content="Rise to the top, or die trying.">
  <meta name="author" content="Manason">
  <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
	<div class="left-sidebar">
		<div class="playerlist">
			<!-- <div class="pl-player">
				<p class="pl-succ">⭐</p>
				<p class="pl-name pl-king">King User1</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-lord">Lord User2</p>
				<p class="pl-button pl-execute" onclick="socket.emit('messageFromClient', {content: '/e User2'});">💀</p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User2'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User2 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-lord">Lord User10</p>
				<p class="pl-button pl-execute selected-icon" onclick="socket.emit('messageFromClient', {content: '/e User10'});">💀</p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User10'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User10 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-duke">Duke User5</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User5'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User5 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-duke">Duke User9</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User9'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User9 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-earl">Earl User11</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User11'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User11 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-knight">Knight User3</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User3'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User3 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-knight">Knight User4</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User4'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User4 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-knight">Knight User8</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User8'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User8 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-knight">Knight User12</p>
				<p></p>
				<p class="pl-button pl-protect selected-icon" onclick="socket.emit('messageFromClient', {content: '/p User12'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User12 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-peasant">Peasant User6</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User6'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User6 2'});">💸</p>
			</div>
			<div class="pl-player">
				<p class="pl-succ disabled-icon">🥈</p>
				<p class="pl-name pl-peasant">Peasant User7</p>
				<p></p>
				<p class="pl-button pl-protect" onclick="socket.emit('messageFromClient', {content: '/p User7'});">👼🏻</p>
				<p class="pl-button pl-give" onclick="socket.emit('messageFromClient', {content: '/g User7 2'});">💸</p>
			</div> -->
		</div>
	</div>
	<div class="main-area">
		<div class="chat">
			<div class="chat-header">
			</div>
			<div class="chat-window">
				<!-- <div class="chat-entry">
					<p class="chat-name pl-king">[King Manason]</p>
					<p class="chat-message pl-king">This is an example message</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name pl-duke">[Duke Manason]</p>
					<p class="chat-message">This is an example message</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name pl-knight">[Knight Manason]</p>
					<p class="chat-message">This is an example message</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name pl-peasant">[Peasant Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name pl-earl">[Earl Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name pl-lord">[Lord Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name">[Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name">[Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name">[Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name">[Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name">[Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div>
				<div class="chat-entry">
					<p class="chat-name">[Manason]</p>
					<p class="chat-message">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.</p>
				</div> -->
			</div>

			<div class="chat-input">
				<input class="chat-input-box" type="text"></input>
				<input class="chat-input-button" type="submit" value="Send" onclick="enterInput();"></input>
			</div>
		</div>
		<div class="right-sidebar">
			<div class="state">
				<div class="gamestate">
					<p>Lobby</p>
				</div>
				<div class="timer">
					<p>Waiting...</p>
				</div>
			</div>
			<div class="player-module">
				<p class="pm-icon">👻</p>
				<p class="pm-name">Spectator</p>
				<p class="pm-prestige">Prestige: 0</p>
				<p class="pm-info">
					Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source.
				</p>
			</div>
			<div class="kings-module hidden">
				<p class="km-header">Lookup</p>
				<div class="km-buttons km-lookup">
					<p class="km-button" onclick="socket.emit('messageFromClient', {content: '/lookup Lord'});">💎</p>
					<p class="km-button" onclick="socket.emit('messageFromClient', {content: '/lookup Duke'});">🏰</p>
					<p class="km-button" onclick="socket.emit('messageFromClient', {content: '/lookup Earl'});">📜</p>
					<p class="km-button" onclick="socket.emit('messageFromClient', {content: '/lookup Knight'});">🛡️</p>
					<p class="km-button" onclick="socket.emit('messageFromClient', {content: '/lookup Peasant'});">⚒️</p>
				</div>
				<p class="km-header">Tax</p>
				<div class="km-buttons">
					<p class="km-button km-tax km-lord" onclick="socket.emit('messageFromClient', {content: '/tax Lord'});">💎</p>
					<p class="selected-icon km-button km-tax km-duke" onclick="socket.emit('messageFromClient', {content: '/tax Duke'});">🏰</p>
					<p class="km-button km-tax km-earl" onclick="socket.emit('messageFromClient', {content: '/tax Earl'});">📜</p>
					<p class="km-button km-tax km-knight" onclick="socket.emit('messageFromClient', {content: '/tax Knight'});">🛡️</p>
					<p class="km-button km-tax km-peasant" onclick="socket.emit('messageFromClient', {content: '/tax Peasant'});">⚒️</p>
				</div>
			</div>
		</div>
	</div>
</body>

<script>
	var input = document.getElementsByClassName("chat-input-box")[0];
	var gamestate = document.getElementsByClassName("gamestate")[0];
	var timer = document.getElementsByClassName("timer")[0];
	var socket = io.connect();

	input.onkeypress = function(e){
		if(e.keyCode == '13'){
			enterInput();
		}
	}

	//send message to server for processing
	function enterInput(){
		socket.emit('messageFromClient', {content: input.value});
		input.value = ""; //clear the input
	}

	//receive messages from server
	socket.on('message', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-name">'+
				'<p>['+msg.player+']</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>'+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	//TODO make these different from a normal message
	socket.on('whisper', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-name">'+
				'<p>['+msg.player+']</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>whispered '+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	socket.on('yell', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-name">'+
				'<p>['+msg.player+']</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>YELLED '+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	socket.on('gamestate', function(gmst){
		gamestate.innerHTML = gmst.state;
	});
	socket.on('timer', function(time){
		if(isNaN(time.cur_time))
			timer.innerHTML = time.cur_time;
		else{
			var date = new Date(null);
			date.setSeconds(time.cur_time);
			timer.innerHTML = date.toISOString().substr(11, 8);
		}
	});
	socket.on('updateRole', function(player){
		$(".pm-name").html(player.role + " " + player.name);
		switch(player.role){
			case "King":
				$(".pm-icon").html("👑");
				$(".pm-name").css("color: var(--king);");
				$(".pm-info").html("You are the ruler of the kingdom and wield great power. But remember, no one rules alone. Keep the right people happy or your reign may not last long! <br><br>Special Abilities:<br><ul><li>Lookup the combined prestige of any rank</li> <li>Choose a rank to tax. Tax will be collected during the night. (a random rank will be chosen if no rank has been selected).</li></ul>");
				$(".kings-module").removeClass("hidden");
				break;
			case "Lord":
				$(".pm-icon").html("💎");
				$(".pm-name").css("color: var(--lord);");
				$(".pm-info").html("Your word is second only to the King. Use your knowledge and abilities to secure your position and amass great wealth. Can appoint a Duke as your successor. <br><br>Special Abilities:<br><ul><li>Lookup any players prestige for a small cost</li></ul>");
				break;
			case "Duke":
				$(".pm-icon").html("🏰");
				$(".pm-name").css("color: var(--duke);");
				$(".pm-info").html("You are the backbone of the nobility, with the unique ability to vote for the next king. Be careful of making enemies, lest the common folk decide you are no longer fit for your position. Can appoint an Earl or a Knight as your successor.<br><br>Special Abilities:<br><ul><li>Block one other player once per day, preventing them from using their own special ability. Does not work on Lords or the King. If used on a fellow Duke, only takes effect at the beginning of the following day.</li></ul>");
				break;
			case "Earl":
				$(".pm-icon").html("📜");
				$(".pm-name").css("color: var(--earl);");
				$(".pm-info").html("Well respected as a leader of the common folk and few in number, you are especially vulnerable to Dukes who view you as a threat or Knights itching to take your place. You will often be the first to recognize alliances and plots. Use this to your advantage.<br><br>Special Abilities:<br><ul><li>Notified in real time when one player gives another player prestige. Player names will be redacted.</li></ul>");
				break;
			case "Knight":
				$(".pm-icon").html("🛡️");
				$(".pm-name").css("color: var(--knight);");
				$(".pm-info").html("You have the most powerful ability, and many influential nobility will want to use you. Choose your allies wisely, you will most likely make enemies as well.<br><br>Special Abilities:<br><ul><li>Watch one other player once per day, telling you who they visit, who visits them, and why. Does not work on the King.</li></ul>");
				break;
			case "Peasant":
				$(".pm-icon").html("⚒️");
				$(".pm-name").css("color: var(--peasant);");
				$(".pm-info").html("Weak and poor, you cannot do much alone, but working together with other commoners, you have the power to topple even the King!<br><br>Special Abilities:<br><ul><li>All abilities that would normally cost prestige, are free.</li></ul>");
				break;
			case "Spectator":
				$(".pm-icon").html("👻");
				$(".pm-name").css("color: darkred;");
				$(".pm-info").html("Spectator is the role you have before being assigned a role. Do not worry, you are still in the game, and will receive a role shortly.");
				break;

		}
		if(player.role != "King")
			$(".kings-module").addClass("hidden");
	});
	socket.on('updatePrestige', function(prestige){
		$(".pm-prestige").html("Prestige: " + prestige.amount);
	});
	socket.on('playerlist', function(playerList){
		//update playerList here
		$(".playerlist").empty();
		for(var i = 1; i < playerList.length; i++){
			var playerInfo = playerList[0];
			var playerEntry = '<div class="pl-player">';
			//Set icon for successor
			if(playerInfo.p_name == playerList[i].name)
				playerEntry += '<p class="pl-succ">⭐</p>';
			else if(playerInfo.p_successor == playerList[i].name){
				playerEntry += '<p class="pl-succ">🥇</p>';
			}
			else if((playerInfo.p_role=="Lord" && playerList[i].role=="Duke") || (playerInfo.p_role=="Duke" && (playerList[i].role=="Earl" || playerList[i].role=="Knight"))){
				playerEntry += '<p class="pl-succ" onclick="socket.emit(\'messageFromClient\', {content: \'/sc '+playerList[i].name+'\'});">🥈</p>';
			}
			else{
				playerEntry += '<p class="pl-succ disabled-icon">🥈</p>';
			}
			//Set role and name
			playerEntry += '<p class="pl-name pl-'+playerList[i].role.toLowerCase()+'">' + playerList[i].role + ' ' + playerList[i].name+'</p>';
			if(playerInfo.p_name != playerList[i].name && playerInfo.p_role != "Spectator" && playerList[i].role != "Spectator"){
				//Set execute or assassinate buttons
				if((playerInfo.p_role=="King" && playerList[i].role=="Lord") || (playerInfo.p_role=="Lord" && playerList[i].role=="Duke") || (playerInfo.p_role=="Duke" && playerList[i].role=="Earl")) {
					playerEntry += '<p class="pl-button pl-execute" onclick="socket.emit(\'messageFromClient\', {content: \'/e '+playerList[i].name+'\'});">💀</p>';
				}
				else if(playerInfo.p_role=="Earl" || playerInfo.p_role=="Knight" || playerInfo.p_role=="Peasant")
					playerEntry += '<p class="pl-button pl-assassinate" onclick="socket.emit(\'messageFromClient\', {content: \'/a '+playerList[i].name+'\'});">🗡️</p>';

				//Set button for protect
				playerEntry += '<p class="pl-button pl-protect" onclick="socket.emit(\'messageFromClient\', {content: \'/p '+playerList[i].name+'\'});">👼🏻</p>';
				//Set button for role action
				if(playerInfo.p_role=="Lord"){
					playerEntry += '<p class="pl-button pl-role" onclick="socket.emit(\'messageFromClient\', {content: \'/lookup '+playerList[i].name+'\'});">✨</p>';
				}
				else if(playerInfo.p_role=="Duke"){
					playerEntry += '<p class="pl-button pl-role" onclick="socket.emit(\'messageFromClient\', {content: \'/block '+playerList[i].name+'\'});">✨</p>';
				}
				else if(playerInfo.p_role=="Knight"){
					playerEntry += '<p class="pl-button pl-role" onclick="socket.emit(\'messageFromClient\', {content: \'/watch '+playerList[i].name+'\'});">✨</p>';
				}
				//Set button for give
				playerEntry += '<p class="pl-button pl-give" onclick="socket.emit(\'messageFromClient\', {content: \'/g '+playerList[i].name+' 2\'});">💸</p>';
			}
			playerEntry += '</div>';
			$(".playerlist").append(playerEntry);
			if(playerInfo.p_blocked){
				$(".pl-role").addClass("disabled-icon");
				$(".pl-execute").addClass("disabled-icon");
			}

		}
	});
	socket.on('block', function(){
		$(".pl-role").addClass("disabled-icon");
		$(".pl-execute").addClass("disabled-icon");
	});
	socket.on('setIcons', function(obj){
		if(obj.type == "km-tax"){
			$("."+obj.type).removeClass("selected-icon");
			if(obj.name != "null")
				$(".km-"+obj.name.toLowerCase()).addClass("selected-icon");
		}
		else{
			$(".pl-"+obj.type).removeClass("selected-icon");
			$(".pl-"+obj.type).removeClass("disabled-icon");
			if(obj.name != "null"){
				$(".playerlist p.pl-name").filter(function () {
					return $(this).text().endsWith(" "+obj.name);
				}).siblings(".pl-"+obj.type).addClass("selected-icon");

				if(obj.type == "role")
					$(".playerlist p.pl-name").filter(function () {
						return !$(this).text().endsWith(" "+obj.name);
					}).siblings(".pl-"+obj.type).addClass("disabled-icon");
			}
		}
	});

	function randomTesting(){
		//var cmds1 = ["/start","/start idk","/vote","/vote User2","/duke User2","/sc User2","/sc","/tax Spectator","/tax Lords","/tax Duke","/tax earl","/tax King","/lookup User3","/lookup","/lookup Peasant","/lookup King","fuck these command muthafuckin things","/as;dlfkj;ljw4;fowie","/block User3","/block User1","/block","/Watch","/give User3 2"];
		//var cmds2 = ["/ga User3 3","/a","/a User3","/a User2 User1","/assassinate     fuckthis","/protect and serve","/protect User2","/protect asdfjlwk","/protect","/execute","/e User3","/e User3","/e User3","/e User3","/e User3","/prestige","/prestige User2","/list","/playerlist King","/whisper User2 a fucken message thats right bitch", "/whisper","/whisper User1","/yell fucktHIS SHIT"];
		//var commands = cmds1.concat(cmds2);
		var rand = "User"+Math.floor(Math.random()*15 + 1);
		//commands = ["/block " +rand, "/execute " + rand, "/a " + rand, "/protect " + rand, "/watch " + rand, "/list"];
		commands = ["/vote User3", "/a User3", "/e " + rand];
		var randIndex = Math.floor(Math.random()*commands.length);
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>COMMAND</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>'+commands[randIndex]+'</p>'+
			'</div>'+
		'</div>');
		socket.emit('messageFromClient', {content: commands[randIndex]});
	}

	//for testing purposes
	window.onload = function(){
		socket.emit('messageFromClient', {content: "/host hi"});
		socket.emit('messageFromClient', {content: "/join hi"});
		/*setInterval(function(){
			randomTesting();
		},1000);*/
	}

</script>
</html>
