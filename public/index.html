<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Kings and Peasants</title>
  <meta name="description" content="Rise to the top, or die trying.">
  <meta name="author" content="Manason">
  <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
	<div class="state">
		<div class="gamestate">
			<p>Lobby</p>
		</div>
		<div class="timer">
			<p>Waiting...</p>
		</div>
	</div>
	<div class="playerlist">
		<table>
			<tr>
				<td class="">🥈</td>
				<td class="king name">King Manason</td>
				<td class="disabled emoji">🗡️</td>
				<td class="emoji selected">👼🏻</td>
				<td class="emoji">💀</td>
				<td class="emoji">💸</td>
				<td class="emoji">✨</td>
			</tr>
			<tr>
				<td class="">⭐</td>
				<td class="lord name">Lord Jake</td>
				<td class="emoji selected">🗡️</td>
				<td class="emoji">👼🏻</td>
				<td class="emoji">💀</td>
				<td class="emoji">💸</td>
				<td class="emoji">✨</td>
			</tr>
			<!-- <tr>
				<td class="">🥇</td>
				<td class="duke name">Duke Pheo</td>
				<td class="emoji">🗡️</td>
				<td class="emoji">👼🏻</td>
				<td class="emoji">💀</td>
				<td class="emoji selected">💸</td>
				<td class="emoji">✨</td>
			</tr>
			<tr>
				<td class="">🥈</td>
				<td class="duke name">Duke Teddy</td>
				<td class="emoji">🗡️</td>
				<td class="emoji">👼🏻</td>
				<td class="emoji">💀</td>
				<td class="emoji">💸</td>
				<td class="emoji selected">✨</td>
			</tr>
			<tr>
				<td class="">🥈</td>
				<td class="duke name">Duke Keto</td>
				<td class="emoji">🗡️</td>
				<td class="emoji">👼🏻</td>
				<td class="emoji">💀</td>
				<td class="emoji">💸</td>
				<td class="emoji">✨</td>
			</tr> -->
		</table>
		<!-- Example of a player during voting stage-->
		<!-- <div class="player">
			<input type="radio" name="successor">
			<p>Role Name</p>
			<p class="vote-value">0</p>
			<input type="button" value="Vote" class="vote-button">
		</div> -->
		<!--Example of a player during normal play-->
		<!-- <div class="player">
			<input type="radio" name="successor">
			<p>Role Name</p>
			<input type="radio" name="assassinate" class="playerlisticon">
			<input type="radio" name="protect" class="playerlisticon">
			<input type="radio" name="execute" class="playerlisticon">
			<input type="button" value="give" class="playerlisticon">
			<input type="radio" name="roleaction" class="playerlisticon">
		</div> -->
	</div>
	<div class="lookup-and-tax-module">
		<div class="king-lookup">
			<p class="lookup-and-tax-header">Lookup:</p>
			<select name="lookup">
				<option value="Lookup">Lookup</option>
				<option value="Lord">Lords</option>
				<option value="Earl">Earls</option>
				<option value="Knight">Knights</option>
				<option value="Peasant">Peasants</option>
			</select>
		</div>
		<div class="king-tax">
			<p class="lookup-and-tax-header">Tax:</p>
			<input type="radio" name="group-tax" class="role-tax">Lords</input>
			<input type="radio" name="group-tax" class="role-tax">Dukes</input>
			<input type="radio" name="group-tax" class="role-tax">Earls</input>
			<input type="radio" name="group-tax" class="role-tax">Knights</input>
			<input type="radio" name="group-tax" class="role-tax">Peasants</input>
		</div>
	</div>
	<div class="chat">
		<div class="chat-window">
			<!-- <div class="chat-entry">
				<div class="chat-time">
					<p>10:50</p>
				</div>
				<div class="chat-name">
					<p>Manason</p>
				</div>
				<div class="chat-message">
					<p>This is an example message</p>
				</div>
			</div> -->
		</div>

		<div class="chat-input">
				<input class="chat-input-box" type="text"></input>
				<input class="chat-input-button" type="submit" value="Send" onclick="enterInput();"></input>
		</div>
	</div>
</body>

<script>
	var input = document.getElementsByClassName("chat-input-box")[0];
	var gamestate = document.getElementsByClassName("gamestate")[0];
	var timer = document.getElementsByClassName("timer")[0];
	var socket = io.connect('http://localhost:8080');
	input.onkeypress = function(e){
		if(e.keyCode == '13'){
			enterInput();
		}
	}

	//send message to server for processing
	function enterInput(){
		socket.emit('messageFromClient', {content: input.value});
		input.value = ""; //clear the input
	}

	//receive messages from server
	socket.on('message', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>'+msg.player+'</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>'+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	//TODO make these different from a normal message
	socket.on('whisper', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>'+msg.player+'</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>whispered '+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	socket.on('yell', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>'+msg.player+'</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>YELLED '+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	socket.on('gamestate', function(gmst){
		gamestate.innerHTML = gmst.state;
	});
	socket.on('timer', function(time){
		var date = new Date(null);
    	date.setSeconds(time.cur_time);
		timer.innerHTML = date.toISOString().substr(11, 8);
	});
	socket.on('playerlist', function(playerList){
		//update playerList here
		var table = document.getElementsByClassName("playerlist")[0].firstChild;
		$(".playerlist table").empty();
		for(var i = 1; i < playerList.length; i++){
			var playerInfo = playerList[0];
			var tableEntry = '<tr>';
			//Set icon for successor
			if(playerInfo.p_name == playerList[i].name)
				tableEntry += '<td class="pl-succ">⭐</td>';
			else if(playerInfo.p_successor == playerList[i].name){
				tableEntry += '<td class="pl-succ">🥇</td>';
			}
			else if((playerInfo.p_role=="Lord" && playerList[i].role=="Duke") || (playerInfo.p_role=="Duke" && (playerList[i].role=="Earl" || playerList[i].role=="Knight"))){
				tableEntry += '<td class="pl-succ">🥈</td>';
			}
			else{
				tableEntry += '<td class="pl-succ disabled-icon">🥈</td>';
			}
			//Set role and name
			tableEntry += '<td class="pl-name pl-'+playerList[i].role.toLowerCase()+'">' + playerList[i].role + ' ' + playerList[i].name+'</td>';
			if(playerInfo.p_name != playerList[i].name && playerList[i].role != "Spectator"){
				//Set button for role action
				if(playerInfo.p_role=="Lord" && playerInfo.p_role=="Duke" && playerInfo.p_role=="Knight"){
					if(playerInfo.p_blocked)
						tableEntry += '<td class="pl-button pl-role disabled-icon">✨</td>';
					else
						tableEntry += '<td class="pl-button pl-role">✨</td>';
				}
				//Set execute or assassinate buttons
				if((playerInfo.p_role=="King" && playerList[i].role=="Lord") || (playerInfo.p_role=="Lord" && playerList[i].role=="Duke") || (playerInfo.p_role=="Duke" && playerList[i].role=="Earl")) {
					if(playerInfo.p_blocked)
						tableEntry += '<td class="pl-button pl-execute disabled-icon">💀</td>';
					else
						tableEntry += '<td class="pl-button pl-execute">💀</td>';
				}
				else if(playerInfo.p_role=="Earl" || playerInfo.p_role=="Knight" || playerInfo.p_role=="Peasant")
					tableEntry += '<td class="pl-button pl-assassinate">🗡️</td>';
				else
					tableEntry += '<td></td>';
				//Set protect and give buttons
				tableEntry += '<td class="pl-button pl-protect">👼🏻</td>';
				tableEntry += '<td class="pl-button pl-give">💸</td>';
			}
			tableEntry += '</tr>';
			$(".playerlist table").append(tableEntry);
		}
	});
	socket.on('voteUpdate', function(gmst){
		gamestate.innerHTML = gmst.state;
	});
	socket.on('block', function(gmst){
		gamestate.innerHTML = gmst.state;
	});

	function randomTesting(){
		//var cmds1 = ["/start","/start idk","/vote","/vote User2","/duke User2","/sc User2","/sc","/tax Spectator","/tax Lords","/tax Duke","/tax earl","/tax King","/lookup User3","/lookup","/lookup Peasant","/lookup King","fuck these command muthafuckin things","/as;dlfkj;ljw4;fowie","/block User3","/block User1","/block","/Watch","/give User3 2"];
		//var cmds2 = ["/ga User3 3","/a","/a User3","/a User2 User1","/assassinate     fuckthis","/protect and serve","/protect User2","/protect asdfjlwk","/protect","/execute","/e User3","/e User3","/e User3","/e User3","/e User3","/prestige","/prestige User2","/list","/playerlist King","/whisper User2 a fucken message thats right bitch", "/whisper","/whisper User1","/yell fucktHIS SHIT"];
		//var commands = cmds1.concat(cmds2);
		var rand = "User"+Math.floor(Math.random()*15 + 1);
		//commands = ["/block " +rand, "/execute " + rand, "/a " + rand, "/protect " + rand, "/watch " + rand, "/list"];
		commands = ["/vote User3", "/a User3", "/e " + rand];
		var randIndex = Math.floor(Math.random()*commands.length);
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>COMMAND</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>'+commands[randIndex]+'</p>'+
			'</div>'+
		'</div>');
		socket.emit('messageFromClient', {content: commands[randIndex]});
	}

	//for testing purposes
	window.onload = function(){
		socket.emit('messageFromClient', {content: "/host hi"});
		socket.emit('messageFromClient', {content: "/join hi"});
		/*setInterval(function(){
			randomTesting();
		},1000);*/
	}

</script>
</html>
