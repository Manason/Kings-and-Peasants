<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Kings and Peasants</title>
  <meta name="description" content="Rise to the top, or die trying.">
  <meta name="author" content="Manason">
  <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
	<div class="state">
		<div class="gamestate">
			<p>Lobby</p>
		</div>
		<div class="timer">
			<p>Waiting...</p>
		</div>
	</div>
	<div class="chat-window">
		<!-- <div class="chat-entry">
			<div class="chat-time">
				<p>10:50</p>
			</div>
			<div class="chat-name">
				<p>Manason</p>
			</div>
			<div class="chat-message">
				<p>This is an example message</p>
			</div>
		</div> -->
	</div>

	<div class="chat-input">
			<input class="chat-input-box" type="text"></input>
			<input class="chat-input-button" type="submit" value="Send" onclick="enterInput();"></input>
	</div>
</body>

<script>
	var input = document.getElementsByClassName("chat-input-box")[0];
	var gamestate = document.getElementsByClassName("gamestate")[0];
	var timer = document.getElementsByClassName("timer")[0];
	var socket = io.connect('http://localhost:8080');
	input.onkeypress = function(e){
		if(e.keyCode == '13'){
			enterInput();
		}
	}

	//send message to server for processing
	function enterInput(){
		socket.emit('messageFromClient', {content: input.value});
		input.value = ""; //clear the input
	}

	//receive messages from server
	socket.on('message', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>'+msg.player+'</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>'+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	//TODO make these different from a normal message
	socket.on('whisper', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>'+msg.player+'</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>whispered '+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	socket.on('yell', function(msg){
		var timestamp = new Date().toTimeString().substring(0, 8);
		$(".chat-window").append(
		'<div class="chat-entry">' +
			'<div class="chat-time">'+
				'<p>'+timestamp+'</p>'+
			'</div>'+
			'<div class="chat-name">'+
				'<p>'+msg.player+'</p>'+
			'</div>'+
			'<div class="chat-message">'+
				'<p>YELLED '+msg.message+'</p>'+
			'</div>'+
		'</div>');
	});
	socket.on('gamestate', function(gmst){
		gamestate.innerHTML = gmst.state;
	});
	socket.on('timer', function(time){
		var date = new Date(null);
    	date.setSeconds(time.cur_time);
		timer.innerHTML = date.toISOString().substr(11, 8);
	});

	function randomTesting(){
		var cmds1 = ["/start","/start idk","/vote","/vote User2","/duke User2","/sc User2","/sc","/tax Spectator","/tax Lords","/tax Duke","/tax earl","/tax King","/lookup User3","/lookup","/lookup Peasant","/lookup King","fuck these command muthafuckin things","/as;dlfkj;ljw4;fowie","/block User3","/block User1","/block","/Watch","/give User3 2"];
		var cmds2 = ["/ga 100 User4","/a","/a User3","/a User2 User1","/assassinate     fuckthis","/protect and serve","/protect User2","/protect asdfjlwk","/protect","/execute","/e User3","/e User3","/e User3","/e User3","/e User3","/prestige","/prestige User2","/list","/playerlist King","/whisper User2 a fucken message thats right bitch", "/whisper","/whisper User1","/yell fucktHIS SHIT"];
		var commands = cmds1.concat(cmds2);
		var randIndex = Math.floor(Math.random()*commands.length);
			socket.emit('messageFromClient', {content: commands[randIndex]});
	}

	//for testing purposes
	window.onload = function(){
		socket.emit('messageFromClient', {content: "/join hi"});
		setInterval(function(){
			randomTesting();
		},1000);
	}
</script>
</html>
